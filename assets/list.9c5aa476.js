import{d as Ie,r as y,n as ze,m as Re,a2 as ut,o as P,s as G,F as E,y as x,A as W,c as ie,e as n,a3 as He,D as K,b as u,w as i,T as $e,a4 as Le,M as je,E as it,a5 as Je,C as lt,a6 as ot,I as M,P as Z,a7 as st,a8 as rt,l as ct,k as dt,a9 as ft,p as vt,aa as pt,ab as ht,a as mt,ac as yt,ad as Fe,H as ye,S as fe,ae as Ye,Q as X,af as kt,ag as gt,ah as _t,ai as bt,aj as Et,W as wt,O as ve,ak as Ve,R as ke,al as pe,am as Ft,an as At,B as le,U as $,G as Dt,ao as Ct,ap as xt,aq as St,j as Tt,ar as Bt}from"./vendor.60359f7c.js";import{i as J,b as Me,n as Pt}from"./index.690d0468.js";import{_ as Nt,s as Ge}from"./StreamSaver.55f74170.js";const Ot={class:"container"},$t={class:"status-bar-wrapper"},Lt={class:"task-list"},Mt={class:"task-info"},Ut={class:"task-file-icon"},It=["src"],zt={class:"task-info-wrapper"},Rt={class:"task-file-name"},Ht={class:"task-desc-wrapper"},jt={class:"task-desc"},Jt=E("div",{class:"task-dot"},null,-1),Yt={class:"task-desc"},Vt={class:"task-progress",style:{width:"60px","margin-right":"6px"}},Gt=x(" \u786E\u5B9A\u5220\u9664\uFF1F "),Wt=Ie({setup(Ae,{expose:N}){const C=y(),U=y(!1),L=y(0),d=y(),f=y(!0),l=y(),v=()=>{U.value=!0,J.get("https://api-drive.mypikpak.com/drive/v1/tasks",{params:{type:"offline",filters:{phase:{eq:"PHASE_TYPE_RUNNING"}},page_token:l.value||void 0,thumbnail_size:"SIZE_LARGE",with:"reference_resource"}}).then(g=>{const{tasks:F,next_page_token:D}=g.data;d.value&&clearTimeout(d.value),l.value||(C.value=[]),C.value=C.value.concat(F),l.value=D,C.value.length&&!f.value&&(d.value=setTimeout(()=>{v()},3e4)),U.value=!1})},k=g=>{J.delete("https://api-drive.mypikpak.com/drive/v1/tasks",{params:{task_ids:C.value[g].id,_t:new Date().getTime()}}).then(()=>{C.value[g].progress<100&&L.value--,C.value.splice(g,1)})},h=g=>{g.target.offsetHeight-g.target.scrollTop<30&&l.value&&!U.value&&v()};return ze(f,()=>{f.value&&d.value?clearTimeout(d.value):v()}),Re(v),ut(()=>{d.value&&clearTimeout(d.value)}),N({getTask:v}),(g,F)=>{var D;return P(),G("div",Ot,[E("div",{class:it(["content",{hide:f.value}])},[E("div",{class:"status-bar",onClick:F[0]||(F[0]=p=>f.value=!f.value)},[E("div",$t,[x(W(((D=C.value)==null?void 0:D.length)||0)+"\u9879\u4FDD\u5B58\u4E2D \xA0 ",1),U.value?(P(),ie(n(He),{key:0,size:"small"})):K("",!0)])]),E("div",Lt,[u(n(je),{style:{"max-height":"400px"},onScroll:h},{default:i(()=>[(P(!0),G($e,null,Le(C.value,(p,A)=>(P(),G("div",{key:p.id,class:"task"},[E("div",Mt,[E("div",Ut,[E("img",{src:p.icon_link},null,8,It)]),E("div",zt,[E("div",Rt,[u(n(Je),{tooltip:{width:"trigger"}},{default:i(()=>[x(W(p.file_name),1)]),_:2},1024)]),E("div",Ht,[E("div",jt,W(n(Me)(p.file_size)),1),Jt,E("div",Yt,W(p.message),1)])]),E("div",Vt,[u(n(lt),{type:"line",percentage:p.progress,processing:"","indicator-placement":"inside"},null,8,["percentage"])]),u(n(ot),{onPositiveClick:_=>k(A),placement:"right"},{trigger:i(()=>[u(n(M),{color:"#306eff"},{default:i(()=>[u(n(Z))]),_:1})]),default:i(()=>[Gt]),_:2},1032,["onPositiveClick"])])]))),128))]),_:1})]),f.value?K("",!0):(P(),G("p",{key:0,class:"bottom",onClick:F[1]||(F[1]=p=>f.value=!0)},"\u6536\u8D77"))],2)])}}});var We={exports:{}};/*!
 * clipboard.js v2.0.8
 * https://clipboardjs.com/
 *
 * Licensed MIT Â© Zeno Rocha
 */(function(Ae,N){(function(U,L){Ae.exports=L()})(st,function(){return function(){var C={134:function(d,f,l){l.d(f,{default:function(){return ge}});var v=l(279),k=l.n(v),h=l(370),g=l.n(h),F=l(817),D=l.n(F);function p(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?p=function(o){return typeof o}:p=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},p(c)}function A(c,s){if(!(c instanceof s))throw new TypeError("Cannot call a class as a function")}function _(c,s){for(var o=0;o<s.length;o++){var m=s[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,m.key,m)}}function B(c,s,o){return s&&_(c.prototype,s),o&&_(c,o),c}var oe=function(){function c(s){A(this,c),this.resolveOptions(s),this.initSelection()}return B(c,[{key:"resolveOptions",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=o.action,this.container=o.container,this.emitter=o.emitter,this.target=o.target,this.text=o.text,this.trigger=o.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"createFakeElement",value:function(){var o=document.documentElement.getAttribute("dir")==="rtl";this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[o?"right":"left"]="-9999px";var m=window.pageYOffset||document.documentElement.scrollTop;return this.fakeElem.style.top="".concat(m,"px"),this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.fakeElem}},{key:"selectFake",value:function(){var o=this,m=this.createFakeElement();this.fakeHandlerCallback=function(){return o.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.container.appendChild(m),this.selectedText=D()(m),this.copyText(),this.removeFake()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=D()(this.target),this.copyText()}},{key:"copyText",value:function(){var o;try{o=document.execCommand(this.action)}catch{o=!1}this.handleResult(o)}},{key:"handleResult",value:function(o){this.emitter.emit(o?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),document.activeElement.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"copy";if(this._action=o,this._action!=="copy"&&this._action!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(o){if(o!==void 0)if(o&&p(o)==="object"&&o.nodeType===1){if(this.action==="copy"&&o.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(this.action==="cut"&&(o.hasAttribute("readonly")||o.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`);this._target=o}else throw new Error('Invalid "target" value, use a valid Element')},get:function(){return this._target}}]),c}(),se=oe;function I(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?I=function(o){return typeof o}:I=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},I(c)}function Q(c,s){if(!(c instanceof s))throw new TypeError("Cannot call a class as a function")}function he(c,s){for(var o=0;o<s.length;o++){var m=s[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,m.key,m)}}function De(c,s,o){return s&&he(c.prototype,s),o&&he(c,o),c}function Ce(c,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(s&&s.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),s&&ee(c,s)}function ee(c,s){return ee=Object.setPrototypeOf||function(m,b){return m.__proto__=b,m},ee(c,s)}function te(c){var s=ae();return function(){var m=O(c),b;if(s){var S=O(this).constructor;b=Reflect.construct(m,arguments,S)}else b=m.apply(this,arguments);return xe(this,b)}}function xe(c,s){return s&&(I(s)==="object"||typeof s=="function")?s:Se(c)}function Se(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function O(c){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},O(c)}function re(c,s){var o="data-clipboard-".concat(c);if(!!s.hasAttribute(o))return s.getAttribute(o)}var Te=function(c){Ce(o,c);var s=te(o);function o(m,b){var S;return Q(this,o),S=s.call(this),S.resolveOptions(b),S.listenClick(m),S}return De(o,[{key:"resolveOptions",value:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof b.action=="function"?b.action:this.defaultAction,this.target=typeof b.target=="function"?b.target:this.defaultTarget,this.text=typeof b.text=="function"?b.text:this.defaultText,this.container=I(b.container)==="object"?b.container:document.body}},{key:"listenClick",value:function(b){var S=this;this.listener=g()(b,"click",function(ne){return S.onClick(ne)})}},{key:"onClick",value:function(b){var S=b.delegateTarget||b.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new se({action:this.action(S),target:this.target(S),text:this.text(S),container:this.container,trigger:S,emitter:this})}},{key:"defaultAction",value:function(b){return re("action",b)}},{key:"defaultTarget",value:function(b){var S=re("target",b);if(S)return document.querySelector(S)}},{key:"defaultText",value:function(b){return re("text",b)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],S=typeof b=="string"?[b]:b,ne=!!document.queryCommandSupported;return S.forEach(function(q){ne=ne&&!!document.queryCommandSupported(q)}),ne}}]),o}(k()),ge=Te},828:function(d){var f=9;if(typeof Element!="undefined"&&!Element.prototype.matches){var l=Element.prototype;l.matches=l.matchesSelector||l.mozMatchesSelector||l.msMatchesSelector||l.oMatchesSelector||l.webkitMatchesSelector}function v(k,h){for(;k&&k.nodeType!==f;){if(typeof k.matches=="function"&&k.matches(h))return k;k=k.parentNode}}d.exports=v},438:function(d,f,l){var v=l(828);function k(F,D,p,A,_){var B=g.apply(this,arguments);return F.addEventListener(p,B,_),{destroy:function(){F.removeEventListener(p,B,_)}}}function h(F,D,p,A,_){return typeof F.addEventListener=="function"?k.apply(null,arguments):typeof p=="function"?k.bind(null,document).apply(null,arguments):(typeof F=="string"&&(F=document.querySelectorAll(F)),Array.prototype.map.call(F,function(B){return k(B,D,p,A,_)}))}function g(F,D,p,A){return function(_){_.delegateTarget=v(_.target,D),_.delegateTarget&&A.call(F,_)}}d.exports=h},879:function(d,f){f.node=function(l){return l!==void 0&&l instanceof HTMLElement&&l.nodeType===1},f.nodeList=function(l){var v=Object.prototype.toString.call(l);return l!==void 0&&(v==="[object NodeList]"||v==="[object HTMLCollection]")&&"length"in l&&(l.length===0||f.node(l[0]))},f.string=function(l){return typeof l=="string"||l instanceof String},f.fn=function(l){var v=Object.prototype.toString.call(l);return v==="[object Function]"}},370:function(d,f,l){var v=l(879),k=l(438);function h(p,A,_){if(!p&&!A&&!_)throw new Error("Missing required arguments");if(!v.string(A))throw new TypeError("Second argument must be a String");if(!v.fn(_))throw new TypeError("Third argument must be a Function");if(v.node(p))return g(p,A,_);if(v.nodeList(p))return F(p,A,_);if(v.string(p))return D(p,A,_);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function g(p,A,_){return p.addEventListener(A,_),{destroy:function(){p.removeEventListener(A,_)}}}function F(p,A,_){return Array.prototype.forEach.call(p,function(B){B.addEventListener(A,_)}),{destroy:function(){Array.prototype.forEach.call(p,function(B){B.removeEventListener(A,_)})}}}function D(p,A,_){return k(document.body,p,A,_)}d.exports=h},817:function(d){function f(l){var v;if(l.nodeName==="SELECT")l.focus(),v=l.value;else if(l.nodeName==="INPUT"||l.nodeName==="TEXTAREA"){var k=l.hasAttribute("readonly");k||l.setAttribute("readonly",""),l.select(),l.setSelectionRange(0,l.value.length),k||l.removeAttribute("readonly"),v=l.value}else{l.hasAttribute("contenteditable")&&l.focus();var h=window.getSelection(),g=document.createRange();g.selectNodeContents(l),h.removeAllRanges(),h.addRange(g),v=h.toString()}return v}d.exports=f},279:function(d){function f(){}f.prototype={on:function(l,v,k){var h=this.e||(this.e={});return(h[l]||(h[l]=[])).push({fn:v,ctx:k}),this},once:function(l,v,k){var h=this;function g(){h.off(l,g),v.apply(k,arguments)}return g._=v,this.on(l,g,k)},emit:function(l){var v=[].slice.call(arguments,1),k=((this.e||(this.e={}))[l]||[]).slice(),h=0,g=k.length;for(h;h<g;h++)k[h].fn.apply(k[h].ctx,v);return this},off:function(l,v){var k=this.e||(this.e={}),h=k[l],g=[];if(h&&v)for(var F=0,D=h.length;F<D;F++)h[F].fn!==v&&h[F].fn._!==v&&g.push(h[F]);return g.length?k[l]=g:delete k[l],this}},d.exports=f,d.exports.TinyEmitter=f}},U={};function L(d){if(U[d])return U[d].exports;var f=U[d]={exports:{}};return C[d](f,f.exports,L),f.exports}return function(){L.n=function(d){var f=d&&d.__esModule?function(){return d.default}:function(){return d};return L.d(f,{a:f}),f}}(),function(){L.d=function(d,f){for(var l in f)L.o(f,l)&&!L.o(d,l)&&Object.defineProperty(d,l,{enumerable:!0,get:f[l]})}}(),function(){L.o=function(d,f){return Object.prototype.hasOwnProperty.call(d,f)}}(),L(134)}().default})})(We);var qt=rt(We.exports);const Kt={class:"list-page list-page-files"},Zt={class:"header"},Xt={class:"title n-ellipsis"},Qt=x("\u6587\u4EF6"),ea={class:"action"},ta=x(" \u6DFB\u52A0\u81EA\u5B9A\u4E49\u83DC\u5355 "),aa={key:0,class:"loading"},na=x("\u52A0\u8F7D\u4E2D "),ua={key:0,class:"outer-wrapper static show"},ia={class:"toolbar-wrapper"},la=x(" \u590D\u5236\u6240\u9009 "),oa=x(" \u526A\u5207\u6240\u9009 "),sa=x(" \u63A8\u9001\u5230Aria2 "),ra=x(" \u5206\u4EAB\u79D2\u4F20 "),ca=x(" \u5220\u9664\u6240\u9009 "),da=E("div",null,"1.\u652F\u6301Magnet\u94FE\u63A5(magnet:?xt=urn)\uFF0CMagent\u94FE\u63A5\u53EA\u80FD\u9ED8\u8BA4\u4FDD\u5B58\u5230My Pack",-1),fa=E("div",null,"2.\u652F\u6301\u79D2\u4F20\u94FE\u63A5(PikPak://PikPak Tutorial.mp4|19682618|123)\u79D2\u4F20\u94FE\u63A5\u9ED8\u8BA4\u4FDD\u5B58\u5230\u5F53\u524D\u6587\u4EF6\u5939\u6216\u7B2C\u4E00\u4E2A\u6587\u4EF6\u5939\u4E0D\u80FD\u4FDD\u5B58\u5230\u6839\u76EE\u5F55",-1),va=E("div",null,"3.\u652F\u6301\u65B0\u5EFA\u6587\u4EF6\u5939\uFF08\u666E\u901A\u683C\u5F0F\uFF09",-1),pa=E("div",null,"4.\u6362\u884C\u6DFB\u52A0\u591A\u4E2A",-1),ha=E("br",null,null,-1),ma=x("\u6DFB\u52A0"),ya={style:{width:"100%",height:"100%"}},ka={style:{width:"100%",height:"calc(100vh - 80px)","text-align":"center"}},ga=["src"],_a=x("\u91CD\u547D\u540D"),ba=x("\u6DFB\u52A0"),Ea=x(" \u5206\u4EAB\u94FE\u63A5\u6709\u6548\u671F\u4E3A24\u5C0F\u65F6 "),wa=E("br",null,null,-1),Fa=x("\u83B7\u53D6\u5206\u4EAB\u94FE\u63A5"),xa=Ie({setup(Ae){const N=y(),C=ct(),U=dt(),L=ft(),d=y([]),f=vt(),l=y([{title:"\u4FEE\u6539\u65F6\u95F4",key:"modified_time",sorter:"default",align:"right",render:e=>$(Dt,{time:new Date(String(e.modified_time)||""),format:"MM-dd HH:MM"}),className:"modified_time",width:160}]),v=y([{type:"selection"},{title:"\u540D\u79F0",key:"name",sorter:"default",render:e=>$("div",{class:"file-info",onClick:()=>{e.kind==="drive#folder"?U.push("/list/"+e.id):(e.mime_type.indexOf("video")!=-1||e.mime_type.indexOf("image")!=-1||e.mime_type.indexOf("audio")!=-1)&&B(e.id).then(t=>{_.value=t.data,_.value.web_content_link&&(e.mime_type.indexOf("video")!=-1||e.mime_type.indexOf("audio")!=-1?oe.value=!0:se.value=!0)})}},[$("img",{src:e.thumbnail_link||e.icon_link}),$(Je,{class:"title"},{default:()=>String(e.name)}),$("span",{class:"action"},"1")])},{title:"\u5927\u5C0F",key:"size",sorter:(e,t)=>e.size-t.size,align:"right",render:e=>Number(e.size)>0?Me(Number(e.size)):"",className:"size",width:100},{title:"",key:"action",width:60,align:"right",render:e=>$(Fe,{justify:"end"},{default:()=>[!A.value&&$(le,{type:"primary",onClick:()=>Ue(e)},{default:()=>"\u91CD\u547D\u540D"}),!A.value&&$(le,{type:"primary",onClick:()=>Pe([e.id])},{default:()=>"\u590D\u5236"}),!A.value&&$(le,{type:"primary",onClick:()=>Be([e.id])},{default:()=>"\u526A\u8D34"}),!A.value&&e.kind==="drive#file"&&$(le,{type:"primary",onClick:()=>ge(e.id)},{default:()=>"\u4E0B\u8F7D"}),!A.value&&e.kind==="drive#file"&&$(le,{type:"primary",onClick:()=>{ue.value="",be.value=e,Ee.value="",de.value=!0}},{default:()=>"\u5206\u4EAB"}),!A.value&&$(le,{type:"primary",onClick:()=>{f.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u5220\u9664"+e.name+"\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{ee(String(e.id))}})}},{default:()=>"\u5220\u9664"}),$(Ct,{trigger:"click",placement:"bottom-end",options:at(e),onSelect:t=>{switch(t){case"name":Ue(e);break;case"batchCopy":Pe([e.id]);break;case"batchMove":Be([e.id]);break;case"down":ge(e.id);break;case"copyDown":B(e.id).then(r=>{te(r.data.web_content_link)});break;case"aria2Post":B(e.id).then(r=>{o(r)});break;case"code":te(`PikPak://${e.name}|${e.size}|${e.hash}`);break;case"base":window.localStorage.setItem("pikpakUploadFolder",JSON.stringify(e));break;case"share":b(e);break;case"delete":f.warning({title:"\u8B66\u544A",content:"\u786E\u5B9A\u5220\u9664"+e.name+"\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{ee(String(e.id))}});break;case"sharePikPak":ue.value="",be.value=e,Ee.value="",de.value=!0;break;default:if(t.indexOf("user")!==-1){const r=Number(t.replace("user-","")),a=V.value[r];a&&B(e.id).then(w=>{const T=z=>z.replace(/\{\{(.*?)\}\}/g,(R,we)=>w.data[we.trim()]);a.type==="a"?window.open(T(a.content),"_target"):a.type==="copy"&&te(T(a.content))})}break}}},{default:()=>$(M,{color:"#306eff"},{default:()=>$(xt)})})]})}]),k=y(!1),h=y(),g=()=>{k.value=!0,J.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:C.params.id,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:h.value||void 0,filters:{phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}}}}).then(e=>{const{data:t}=e;h.value||(N.value=[]),N.value=N.value.concat(t.files),h.value=t.next_page_token}).finally(()=>{k.value=!1})},F=()=>{q.value=JSON.parse(window.localStorage.getItem("pikpakMoveFiles")||"[]"),ce.value=JSON.parse(window.localStorage.getItem("pikpakCopyFiles")||"[]"),V.value=JSON.parse(window.localStorage.getItem("pikpakUserMenu")||"[]"),N.value=[],d.value=[],h.value="",g(),p.value={},C.params.id&&B(String(C.params.id)).then(e=>{p.value=e.data})};ze(C,()=>{F()});const D=y(),p=y(),A=y(!0);Re(()=>{document.body.clientWidth>968&&(A.value=!1,v.value.splice(2,0,...l.value),v.value[v.value.length-1].width=300);let t=JSON.parse(window.localStorage.getItem("pikpakAria2")||"{}");t.dir===void 0&&(t.dir=!0),t.host&&(D.value=t),F(),window.onbeforeunload=function(r){return!window.$downId||window.$downId.length===0?null:(r=r||window.event,r&&(r.returnValue="\u8FD8\u6709\u5F85\u4E0B\u8F7D\u6587\u4EF6"),"\u8FD8\u6709\u5F85\u4E0B\u8F7D\u6587\u4EF6?")}});const _=y(),B=e=>J.get("https://api-drive.mypikpak.com/drive/v1/files/"+e,{params:{_magic:"2021",thumbnail_size:"SIZE_LARGE"}}).then(t=>t),oe=y(!1),se=y(!1),I=y(!1),Q=y(),he=y(),De=pt(()=>{let e="";if(C.params.id)e=String(C.params.id);else for(let t in N.value)if(N.value[t].kind==="drive#folder"){e=N.value[t].id;break}return e}),Ce=()=>{const e=Q.value.split(`
`);let t=0,r=!1,a=!1;e.forEach(w=>{if(w){let T={};if(w.indexOf("PikPak://")===0){const z=w.substring(9).split("|");a=!0,T={kind:"drive#file",parent_id:De.value,name:z[0],size:z[1],hash:z[2],upload_type:"UPLOAD_TYPE_RESUMABLE",objProvider:{provider:"UPLOAD_TYPE_UNKNOWN"}}}else w.indexOf("magnet:?xt=urn")===0?(r=!0,T={kind:"drive#file",name:"",parent_id:C.params.id||"",upload_type:"UPLOAD_TYPE_URL",url:{url:w},params:{from:"file"},folder_type:"DOWNLOAD"}):(a=!0,T={kind:"drive#folder",parent_id:C.params.id||"",name:w});I.value=!1,J.post("https://api-drive.mypikpak.com/drive/v1/files",T).then(z=>{(z.data.upload_type==="UPLOAD_TYPE_UNKNOWN"||w.indexOf("PikPak://")===-1)&&window.$message.success("\u6DFB\u52A0\u6210\u529F")}).finally(()=>{t++,t===e.length&&(Q.value="",r&&he.value.getTask(),a&&(h.value="",g()))})}else t++})},ee=e=>{J.post("https://api-drive.mypikpak.com/drive/v1/files:batchTrash",{ids:typeof e=="string"?[e]:e}).then(()=>{window.$message.success("\u5220\u9664\u6210\u529F"),h.value="",g()})},te=e=>{St(()=>{const t=document.createElement("button"),r=new qt(t,{text:()=>e,action:()=>"copy"});r.on("success",a=>{window.$message.success("\u590D\u5236\u6210\u529F"),r.destroy()}),r.on("error",a=>{window.$message.error("\u590D\u5236\u5931\u8D25\uFF0C\u60A8\u53EF\u4EE5F12\u6253\u5F00\u63A7\u5236\u53F0\u624B\u52A8\u590D\u5236\uFF0C\u6216\u91CD\u65B0\u64CD\u4F5C"),console.log(a.text)}),t.click()})},xe=async()=>{let e="";if(ae.value)return!1;await re("\u5206\u4EAB\u79D2\u4F20");for(let t in Y.value){const r=Y.value[t];O.value&&(O.value.content=O.value.content+`\r
\u83B7\u53D6`+r.parent+"/"+r.name+"\u6210\u529F"),e=e+`PikPak://${r.name}|${r.size}|${r.hash}
`}te(e),setTimeout(()=>{var t;ae.value=!1,(t=O.value)==null||t.destroy()},1e3)},Se=ht(),ae=y(!1),O=y(),re=async e=>{Y.value=[],ae.value=!0,O.value=Se.create({title:e||"\u63A8\u9001\u5230Aria2",closable:!1,content:"\u6B63\u5728\u83B7\u53D6\u5168\u90E8\u6587\u4EF6\u5217\u8868"});const t=JSON.parse(JSON.stringify(d.value));d.value=[];for(let r in N.value){const a=N.value[r];t.indexOf(a.id)!==-1&&(a.kind==="drive#file"?Y.value.push({id:a.id,name:a.name,parent:"",size:a.size,hash:a.hash}):await Ne(a.id,"",a.name))}O.value.content="\u5171\u83B7\u53D6\u5230"+Y.value.length+"\u4E2A\u6587\u4EF6"},Te=async()=>{if(ae.value)return!1;await re(),!c.value&&D.value.dir&&await s();const e=()=>{B(Y.value[0].id).then(async t=>{var a,w;const r=Y.value.shift();await o(t,r.parent),((a=O.value)==null?void 0:a.content)&&(O.value.content=((w=O.value)==null?void 0:w.content)+`\r
\u63A8\u9001`+r.parent+"/"+r.name+"\u6210\u529F"),Y.value.length?setTimeout(()=>{e()},3e3):setTimeout(()=>{var T;(T=O.value)==null||T.destroy(),ae.value=!1},1e3)})};e()},ge=e=>{B(e).then(t=>{Ge.mitm="mitm.html";const r=Ge.createWriteStream(t.data.name);fetch(t.data.web_content_link).then(a=>{window.$downId||(window.$downId=[]),window.$downId.push(e);const w=a.body;if(window.WritableStream&&(w==null?void 0:w.pipeTo))return w.pipeTo(r).then(()=>{window.$downId.splice(window.$downId.indexOf(e),1)});const T=r.getWriter(),z=a.body.getReader(),R=()=>z.read().then(we=>{we.done?T.close():T.write(we.value).then(R)});R()})})},c=y(),s=()=>{let e={id:"",jsonrpc:"2.0",method:"aria2.getGlobalOption",params:[]};D.value.token&&e.params.splice(0,0,"token:"+D.value.token),fetch(D.value.host,{method:"POST",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})}).then(t=>t.json()).then(t=>{var r;c.value=((r=t==null?void 0:t.result)==null?void 0:r.dir)||""})},o=(e,t)=>{let r={id:"",jsonrpc:"2.0",method:"aria2.addUri",params:[[e.data.web_content_link],{out:e.data.name}]};t&&c.value&&(r.params[1].dir=c.value+"/"+t),D.value.token&&r.params.splice(0,0,"token:"+D.value.token),fetch(D.value.host,{method:"POST",body:JSON.stringify(r),headers:new Headers({"Content-Type":"application/json"})}).then(a=>a.json()).then(a=>{a.error&&a.error.message?window.$message.error(a.error.message):a.result&&window.$message.success("\u63A8\u9001\u6210\u529F")}).catch(a=>console.error("Error:",a))},m=e=>{e.target.offsetHeight-e.target.scrollTop<30&&h.value&&!k.value&&g()},b=e=>{let t=`PikPak://${e.name}|${e.size}|${e.hash}`;const r=JSON.parse(window.localStorage.getItem("pikpakUser")||"{}");Pt.post("https://api.notion.com/v1/pages",{parent:{database_id:"f90e8e28b55e423185f44c89c53c573c"},properties:{\u5206\u7C7B:{select:{name:"\u6765\u81EAPikPak\u7F51\u9875"}},\u6807\u7B7E:{select:{name:"\u5176\u4ED6"}},\u53D1\u5E03\u4EBA:{rich_text:[{text:{content:r.name||""}}]},\u540D\u79F0:{title:[{text:{content:e.name}}]},\u94FE\u63A5:{rich_text:[{text:{content:t}}]},\u5927\u5C0F:{rich_text:[{text:{content:Me(e.size)}}]}}}).then(a=>{console.log(a),window.$message.success("\u5206\u4EAB\u6210\u529F")}).catch(a=>{console.log(a.response.config.data)})},S=e=>{let t=[];N.value.forEach(r=>{d.value.indexOf(r.id)!==-1&&t.push(r.id)}),Be(t)},ne=e=>{let t=[];N.value.forEach(r=>{d.value.indexOf(r.id)!==-1&&t.push(r.id)}),Pe(t)},q=y(),Be=e=>{q.value=e,window.localStorage.setItem("pikpakMoveFiles",JSON.stringify(e)),window.$message.success("\u526A\u5207\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},ce=y(),Pe=e=>{ce.value=e,window.localStorage.setItem("pikpakCopyFiles",JSON.stringify(e)),window.$message.success("\u590D\u5236\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},qe=()=>{J.post("https://api-drive.mypikpak.com/drive/v1/files:batchMove",{to:{parent_id:C.params.id||""},ids:q.value}).then(e=>{h.value="",g(),window.$message.success("\u526A\u5207\u6210\u529F"),q.value=[],window.localStorage.removeItem("pikpakMoveFiles")})},Ke=()=>{J.post("https://api-drive.mypikpak.com/drive/v1/files:batchCopy",{to:{parent_id:C.params.id||""},ids:ce.value}).then(e=>{h.value="",g(),window.$message.success("\u590D\u5236\u6210\u529F"),ce.value=[],window.localStorage.removeItem("pikpakCopyFiles")})},Ue=e=>{H.value={id:e.id,value:e.name},me.value=!0},me=y(!1),H=y(),Ze=()=>{var e,t;J.patch("https://api-drive.mypikpak.com/drive/v1/files/"+((e=H.value)==null?void 0:e.id),{name:(t=H.value)==null?void 0:t.value}).then(()=>{g(),window.$message.success("\u4FEE\u6539\u6210\u529F"),H.value=null,me.value=!1})},Y=y([]),Ne=async(e,t,r)=>{const a=await J.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:e||void 0,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:t||void 0,filters:{phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}}}}),{files:w,next_page_token:T}=a.data;T&&await Ne(e,T,r);for(let z in w){const R=w[z];R.kind==="drive#folder"?await Ne(R.id,"",(r?r+"/":"")+R.name):Y.value.push({name:R.name,id:R.id,parent:r||"",size:R.size,hash:R.hash})}return 1},Xe=y([{label:"\u94FE\u63A5",value:"a"},{label:"\u590D\u5236",value:"copy"}]),Qe=y({web_content_link:"\u94FE\u63A5",name:"\u540D\u79F0",size:"\u5927\u5C0F",hash:"\u6587\u4EF6HASH\u503C"}),j=y({type:"a",content:"",name:""}),_e=y(!1),V=y([]),et=()=>{V.value.push(JSON.parse(JSON.stringify(j.value))),j.value={type:"a",content:"",name:""},window.localStorage.setItem("pikpakUserMenu",JSON.stringify(V.value))},tt=e=>{V.value.splice(e,1),window.localStorage.setItem("pikpakUserMenu",JSON.stringify(V.value))},at=e=>{const t=[{label:"\u91CD\u547D\u540D",key:"name"},{label:"\u590D\u5236",key:"batchCopy"},{label:"\u526A\u5207",key:"batchMove"},{label:"\u76F4\u63A5\u4E0B\u8F7D",key:"down",disabled:e.size<=0},{label:"\u590D\u5236\u4E0B\u8F7D\u94FE\u63A5",key:"copyDown",disabled:e.size<=0},{label:"\u63A8\u9001\u5230Aria2",key:"aria2Post",disabled:e.size<=0||!D.value||!D.value.host},{label:"\u590D\u5236\u79D2\u4F20",key:"code",disabled:!e.hash},{label:"\u8BBE\u4E3A\u9ED8\u8BA4\u76EE\u5F55",key:"base",disabled:e.kind!=="drive#folder"},{label:"\u5206\u4EAB\u5230\u8D44\u6E90\u5E93",key:"share",disabled:!e.hash},{label:"\u5220\u9664",key:"delete"},{label:"\u76F4\u63A5\u5206\u4EAB",key:"sharePikPak",disabled:e.kind==="drive#folder"}];return e.kind!=="drive#folder"&&V.value.length&&(t.push({type:"divider",key:"d1"}),V.value.forEach((r,a)=>{t.push({label:r.name,key:"user-"+a})})),t},de=y(!1),be=y(),ue=y(),Ee=y(),Oe=y(),nt=()=>{Oe.value=!0,B(be.value.id).then(e=>{Tt.post("https://pikpak-depot.z10.workers.dev",{password:ue.value||"",uid:e.data.user_id,Name:e.data.hash,delete_time:String(new Date().getTime()+24*60*60*1e3),info:{name:e.data.name,file_extension:e.data.file_extension,hash:e.data.hash,id:e.data.id,md5_checksum:e.data.md5_checksum,mime_type:e.data.mime_type,size:e.data.size,thumbnail_link:e.data.thumbnail_link,web_content_link:e.data.web_content_link},info2:{medias:e.data.medias},info3:{links:e.data.links}}).then(t=>{Ee.value=window.location.origin+window.location.pathname+U.resolve({name:"shareInfo",params:{id:t.data.id}}).href,te(Ee.value+(ue.value?" \u63D0\u53D6\u5BC6\u7801  "+ue.value:""))}).catch(t=>{window.$message.error(t.response.error||"\u51FA\u9519\u4E86")}).finally(()=>{Oe.value=!1,de.value=!1})})};return(e,t)=>{const r=mt("router-link");return P(),G("div",Kt,[E("div",Zt,[E("div",Xt,[u(n(yt),{separator:">"},{default:i(()=>[u(n(Ye),null,{default:i(()=>[u(r,{to:"/list"},{default:i(()=>[Qt]),_:1})]),_:1}),p.value&&p.value.name?(P(),ie(n(Ye),{key:0},{default:i(()=>[x(W(p.value.name),1)]),_:1})):K("",!0)]),_:1})]),E("div",ea,[u(n(Fe),null,{default:i(()=>{var a,w;return[((a=q.value)==null?void 0:a.length)?(P(),ie(n(X),{key:0,type:"default",onClick:qe},{default:i(()=>[x(" \u7C98\u8D34\u5DF2\u526A\u5207"+W(q.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):K("",!0),((w=ce.value)==null?void 0:w.length)?(P(),ie(n(X),{key:1,onClick:Ke},{default:i(()=>[x(" \u7C98\u8D34\u5DF2\u590D\u5236"+W(ce.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):K("",!0),u(n(X),{onClick:t[0]||(t[0]=T=>_e.value=!0)},{default:i(()=>[ta]),_:1}),u(n(M),{color:n(L).primaryColor,onClick:t[1]||(t[1]=T=>I.value=!0)},{default:i(()=>[u(n(kt))]),_:1},8,["color"])]}),_:1})])]),u(n(je),{style:{"max-height":"calc(100vh - 190px)"},onScroll:m},{default:i(()=>[u(n(gt),{"checked-row-keys":d.value,"onUpdate:checked-row-keys":t[2]||(t[2]=a=>d.value=a),"row-key":a=>a.id,data:N.value,size:"small",columns:v.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"]),k.value?(P(),G("div",aa,[u(n(He),{size:"small"}),na])):K("",!0)]),_:1}),u(Wt,{ref:(a,w)=>{w.taskRef=a,he.value=a}},null,512),d.value.length?(P(),G("div",ua,[E("div",ia,[E("div",{class:"toolbar-item",onClick:ne},[u(n(ye),null,{trigger:i(()=>[u(n(M),null,{default:i(()=>[u(n(_t))]),_:1})]),default:i(()=>[la]),_:1})]),E("div",{class:"toolbar-item",onClick:S},[u(n(ye),null,{trigger:i(()=>[u(n(M),null,{default:i(()=>[u(n(bt))]),_:1})]),default:i(()=>[oa]),_:1})]),E("div",{class:"toolbar-item",onClick:Te},[u(n(ye),null,{trigger:i(()=>[u(n(M),null,{default:i(()=>[u(n(Et))]),_:1})]),default:i(()=>[sa]),_:1})]),E("div",{class:"toolbar-item",onClick:xe},[u(n(ye),null,{trigger:i(()=>[u(n(M),null,{default:i(()=>[u(n(wt))]),_:1})]),default:i(()=>[ra]),_:1})]),E("div",{class:"toolbar-item",onClick:t[3]||(t[3]=a=>ee(d.value))},[u(n(ye),null,{trigger:i(()=>[u(n(M),null,{default:i(()=>[u(n(Z))]),_:1})]),default:i(()=>[ca]),_:1})])])])):K("",!0),u(n(fe),{show:I.value,"onUpdate:show":t[6]||(t[6]=a=>I.value=a)},{default:i(()=>[u(n(ve),{style:{width:"600px"},title:"\u6DFB\u52A0\u94FE\u63A5\u6216\u65B0\u5EFA\u6587\u4EF6\u5939"},{"header-extra":i(()=>[u(n(M),{onClick:t[4]||(t[4]=a=>I.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),action:i(()=>[u(n(X),{block:!0,type:"primary",disabled:!Q.value,onClick:Ce},{default:i(()=>[ma]),_:1},8,["disabled"])]),default:i(()=>[u(n(Ve),{"show-icon":!1,closable:"",title:"\u6DFB\u52A0\u8BF4\u660E"},{default:i(()=>[da,fa,va,pa]),_:1}),ha,u(n(ke),{type:"textarea",rows:4,placeholder:"\u8BF7\u6309\u8BF4\u660E\u586B\u5199",value:Q.value,"onUpdate:value":t[5]||(t[5]=a=>Q.value=a)},null,8,["value"])]),_:1})]),_:1},8,["show"]),u(n(fe),{show:oe.value,"onUpdate:show":t[8]||(t[8]=a=>oe.value=a)},{default:i(()=>[u(n(ve),{style:{width:"100vw",height:"100vh"},title:_.value?_.value.name:"\u89C6\u9891"},{"header-extra":i(()=>[u(n(M),{onClick:t[7]||(t[7]=a=>oe.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),default:i(()=>[E("div",ya,[u(Nt,{video:_.value},null,8,["video"])])]),_:1},8,["title"])]),_:1},8,["show"]),u(n(fe),{show:se.value,"onUpdate:show":t[10]||(t[10]=a=>se.value=a)},{default:i(()=>[u(n(ve),{style:{width:"100vw",height:"100vh"},title:_.value?_.value.name:"\u56FE\u7247"},{"header-extra":i(()=>[u(n(M),{onClick:t[9]||(t[9]=a=>se.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),default:i(()=>{var a;return[E("div",ka,[E("img",{src:(a=_.value)==null?void 0:a.web_content_link,style:{"max-width":"100%","max-height":"100%"}},null,8,ga)])]}),_:1},8,["title"])]),_:1},8,["show"]),u(n(fe),{show:me.value,"onUpdate:show":t[13]||(t[13]=a=>me.value=a)},{default:i(()=>[u(n(ve),{style:{width:"600px"},title:"\u4FEE\u6539\u540D\u79F0"},{"header-extra":i(()=>[u(n(M),{onClick:t[11]||(t[11]=a=>me.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),action:i(()=>[u(n(X),{block:!0,type:"primary",disabled:!H.value||!H.value.value,onClick:Ze},{default:i(()=>[_a]),_:1},8,["disabled"])]),default:i(()=>[H.value?(P(),ie(n(ke),{key:0,placeholder:H.value.value,value:H.value.value,"onUpdate:value":t[12]||(t[12]=a=>H.value.value=a)},null,8,["placeholder","value"])):K("",!0)]),_:1})]),_:1},8,["show"]),u(n(fe),{show:_e.value,"onUpdate:show":t[18]||(t[18]=a=>_e.value=a)},{default:i(()=>[u(n(ve),{style:{width:"600px"},title:"\u81EA\u5B9A\u4E49\u83DC\u5355"},{"header-extra":i(()=>[u(n(M),{onClick:t[14]||(t[14]=a=>_e.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),default:i(()=>[u(n(At),{"label-width":"160px","label-align":"left","label-placement":"left"},{default:i(()=>[u(n(pe),{label:"\u81EA\u5B9A\u4E49\u83DC\u5355\u5217\u8868\uFF1A"},{default:i(()=>[u(n(Fe),null,{default:i(()=>[(P(!0),G($e,null,Le(V.value,(a,w)=>(P(),ie(n(Bt),{key:w,closable:!0,onClose:T=>tt(w)},{default:i(()=>[x(W(a.name),1)]),_:2},1032,["onClose"]))),128))]),_:1})]),_:1}),u(n(pe),{label:"\u81EA\u5B9A\u4E49\u83DC\u5355\u540D\u79F0\uFF1A"},{default:i(()=>[u(n(ke),{value:j.value.name,"onUpdate:value":t[15]||(t[15]=a=>j.value.name=a)},null,8,["value"])]),_:1}),u(n(pe),{label:"\u81EA\u5B9A\u4E49\u83DC\u5355\u7C7B\u578B\uFF1A"},{default:i(()=>[u(n(Ft),{options:Xe.value,value:j.value.type,"onUpdate:value":t[16]||(t[16]=a=>j.value.type=a)},null,8,["options","value"])]),_:1}),u(n(pe),{label:"\u81EA\u5B9A\u4E49\u83DC\u5355\u53EF\u63D2\u5165\uFF1A"},{default:i(()=>[u(n(Fe),null,{default:i(()=>[(P(!0),G($e,null,Le(Qe.value,(a,w)=>(P(),ie(n(X),{key:w,onClick:T=>j.value.content=j.value.content+"{{"+w+"}}"},{default:i(()=>[x(W(a),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),u(n(pe),{label:"\u81EA\u5B9A\u4E49\u83DC\u5355\u5185\u5BB9\uFF1A"},{default:i(()=>[u(n(ke),{type:"textarea",value:j.value.content,"onUpdate:value":t[17]||(t[17]=a=>j.value.content=a)},null,8,["value"])]),_:1}),u(n(pe),null,{default:i(()=>[u(n(X),{type:"primary",onClick:et},{default:i(()=>[ba]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),u(n(fe),{show:de.value,"onUpdate:show":t[21]||(t[21]=a=>de.value=a)},{default:i(()=>[u(n(ve),{style:{width:"600px"},title:"\u5206\u4EAB"},{"header-extra":i(()=>[u(n(M),{onClick:t[19]||(t[19]=a=>de.value=!1)},{default:i(()=>[u(n(Z))]),_:1})]),action:i(()=>[u(n(X),{block:!0,type:"primary",loading:Oe.value,onClick:nt},{default:i(()=>[Fa]),_:1},8,["loading"])]),default:i(()=>[u(n(Ve),{type:"info",title:"\u786E\u5B9A\u5206\u4EAB"+be.value.name+"\uFF1F"},{default:i(()=>[u(n(le),{type:"error"},{default:i(()=>[Ea]),_:1})]),_:1},8,["title"]),wa,u(n(ke),{placeholder:"\u5206\u4EAB\u5BC6\u7801",type:"password","show-password-on":"mousedown",value:ue.value,"onUpdate:value":t[20]||(t[20]=a=>ue.value=a)},null,8,["value"])]),_:1})]),_:1},8,["show"])])}}});export{xa as default};
